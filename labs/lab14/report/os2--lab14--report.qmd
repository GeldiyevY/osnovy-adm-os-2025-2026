---
# Preamble

## Author
author:
  name: Гелдиев Ыхлас
  degrees: DSc
  orcid: 0000-0002-0877-7063
  email: 1032249184@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: "Лабораторная работа № 14"
subtitle: "Партиции, файловые системы, монтирование"
license: "CC BY"
## Generic options
lang: ru-RU
number-sections: true
toc: true
toc-title: "Содержание"
toc-depth: 2
## Crossref customization
crossref:
  lof-title: "Список иллюстраций"
  lot-title: "Список таблиц"
  lol-title: "Листинги"
## Bibliography
bibliography:
  - bib/cite.bib
csl: _resources/csl/gost-r-7-0-5-2008-numeric.csl
## Formats
format:
  ### Pdf output format
  pdf:
    toc: true
    number-sections: true
    colorlinks: false
    toc-depth: 2
    lof: true # List of figures
    lot: true # List of tables
    #### Document
    documentclass: scrreprt
    papersize: a4
    fontsize: 12pt
    linestretch: 1.5
    #### Language
    babel-lang: russian
    babel-otherlangs: english
    #### Biblatex
    cite-method: biblatex
    biblio-style: gost-numeric
    biblatexoptions:
      - backend=biber
      - langhook=extras
      - autolang=other*
    #### Misc options
    csquotes: true
    indent: true
    header-includes: |
      \usepackage{indentfirst}
      \usepackage{float}
      \floatplacement{figure}{H}
      \usepackage[math,RM={Scale=0.94},SS={Scale=0.94},SScon={Scale=0.94},TT={Scale=MatchLowercase,FakeStretch=0.9},DefaultFeatures={Ligatures=Common}]{plex-otf}
  ### Docx output format
  docx:
    toc: true
    number-sections: true
    toc-depth: 2
---

# Цель работы

Получить навыки создания разделов на диске и файловых систем. Получить навыки монтирования файловых систем.

# Задание

1. Добавьте два диска на виртуальной машине (раздел 14.4.1).
2. Продемонстрируйте навыки создания разделов MBR с помощью fdisk (раздел 14.4.2).
3. Продемонстрируйте навыки создания логических разделов с помощью fdisk (раздел 14.4.3).
4. Продемонстрируйте навыки создания раздела подкачки с помощью fdisk (раздел 14.4.4).
5. Продемонстрируйте навыки создания разделов GPT с помощью gdisk (раздел 14.4.5).
6. Продемонстрируйте навыки форматирования файловой системы XFS (раздел 14.4.6).
7. Продемонстрируйте навыки форматирования файловой системы EXT4 (раздел 14.4.7).
8. Продемонстрируйте навыки ручного монтирования файловых систем (раздел 14.4.8).
9. Продемонстрируйте навыки монтирования файловых систем с помощью /etc/fstab (раздел 14.4.9).
10. Выполните задание для самостоятельной работы (раздел 14.5).

# Выполнение лабораторной работы

## Создание виртуальных носителей

Добавьте к вашей виртуальной машине два диска размером 512 МБ.
Для добавления диска в VirtualBox для вашей виртуальной машины нажмите в меню
Настроить , выберите Носители , затем на контроллере SATA нажмите «Добавить жёсткий
диск». В открывшемся окне нажмите «Создать образ диска», в следующем окне выберите
VDI и нажмите Далее , затем отметьте «Динамический виртуальный жёсткий диск» и нажмите Далее , укажите месторасположение диска и его название (disk1.vdi или disk2.vdi),
а также его размер — 512 МБ, нажмите Создать . В окне выбора жёсткого диска встаньте
на обозначение созданного диска и нажмите Выбрать .
Для добавления второго диска размером 512 МБ к контроллеру SATA повторите указанные выше действия.

![1](image/1.png)

![2](image/2.png)

## Создание разделов MBR с помощью fdisk

1. Запустите вашу виртуальную машину с добавленными дополнительными дисками disk1 и disk2.

   ![3](image/3.png)

2. В командной строке с полномочиями администратора с помощью fdisk посмотрите перечень разделов на всех имеющихся в системе устройствах жёстких дисков:
   su -
   fdisk --list
   В списке должна отразиться информация о добавленных дисках размером 512 MiB, в частности название разделов: /dev/sdb и /dev/sdc.

   ![4](image/4.png)

   ![5](image/5.png)

3. Предположим, что необходимо сделать разметку диска /dev/sdb с помощью утилиты fdisk (измените название раздела, если необходимо, в соответствии с вашим оборудованием):
   fdisk /dev/sdb
   Изменения останутся в памяти только до тех пор, пока вы не решите их записать.
   Будьте внимательны перед использованием команды записи. Утилита fdisk записывает изменения на диск только при вводе команды w . Если вы допустили ошибку и хотите выйти, то нажмите q для выхода из fdisk без записи изменений.

   ![6](image/6.png)

4. Введите m , чтобы получить справку по командам.

   ![7](image/7.png)

5. Прежде чем делать что-либо, рекомендуется проверить, сколько дискового пространства у вас есть. Нажмите p , чтобы просмотреть текущее распределение пространства диска. Обратите внимание на общее количество секторов и последний сектор, который в настоящее время используется. Если последний раздел не заканчивается в последнем секторе, то у вас есть свободное место для создания нового раздела.

   ![8](image/8.png)

6. Введите n , чтобы добавить новый раздел.

   ![9](image/9.png)

7. Выберите p , чтобы создать основной раздел. Примите номер раздела, который предлагается.

   ![10](image/10.png)

8. Укажите первый сектор на диске, с которого начнётся новый раздел. По умолчанию предлагается первый доступный сектор, нажмите Enter для подтверждения выбора.

   ![11](image/11.png)

9. Укажите последний сектор, которым будет завершён раздел. По умолчанию предлагается последний сектор, доступный на диске. Если вы согласитесь с предложенным по умолчанию вариантом, то после этого упражнения у вас не останется свободного места на диске для создания дополнительных разделов или логических томов. Поэтому вы должны использовать другой последний сектор, остановившись на одном из следующих вариантов:

   - ввести номер последнего сектора, который вы хотите использовать;
   - ввести +номер, чтобы создать раздел, размер которого составляет определённое количество секторов;
   - ввести +номер (K, M, G), чтобы указать размер, который вы хотите назначить разделу в KiB, MiB или GiB.
     Например, введите +100M, чтобы создать раздел на 100 MiB.

     ![12](image/12.png)

10. На этом этапе можно определить тип раздела. По умолчанию используется тип раздела Linux. Если вы хотите, чтобы раздел имел какой-либо другой тип, используйте для изменения t . Вам интересны следующие типы разделов:

    - 82: Linux swap;
    - 83: Linux;
    - 8e: Linux LVM.
      Нажмите Enter , чтобы принять тип раздела по умолчанию 83.

      ![13](image/13.png)

11. Нажмите w , чтобы записать изменения на диск и выйти из fdisk.

    ![14](image/14.png)

12. Таблица разделов находится только в памяти ядра. Сравните вывод команды
    fdisk -l /dev/sdb
    с выводом команды
    cat /proc/partitions

    ![15](image/15.png)

    Опишите разницу.

    - fdisk показывает как будет выглядеть разделы после применения, а cat на настоящий момент

13. Запишите изменения в таблицу разделов ядра:
    partprobe /dev/sdb

    ![16](image/16.png)

## Создание логических разделов

1. В терминале с полномочиями администратора запустите
   fdisk /dev/sdb

   ![17](image/17.png)

2. Введите n , чтобы добавить новый раздел.

   ![18](image/18.png)

3. Введите e , чтобы создать расширенный раздел.

   ![19](image/19.png)

4. Если расширенный раздел — четвёртый раздел, который вы записываете в MBR, он также будет последним разделом, который можно добавить в MBR. По этой причине он должен заполнить всю оставшуюся часть жёсткого диска вашего компьютера. Нажмите Enter , чтобы принять первый сектор по умолчанию и снова нажмите Enter , когда fdisk запросит последний сектор.

   ![20](image/20.png)

5. Теперь, когда расширенный раздел создан, вы можете создать в нём логический раздел. Из интерфейса fdisk снова нажмите n . Утилита сообщит, что нет свободных первичных разделов и по умолчанию предложит добавить логический раздел с номером 5.

   ![21](image/21.png)

6. Нажмите Enter , чтобы принять выбор первого сектора в качестве сектора по умолчанию. На вопрос о последнем секторе введите +101M (или любой другой размер, который вы хотите использовать).

   ![22](image/22.png)

7. После создания логического раздела введите w , чтобы записать изменения на диск и выйти из fdisk. Чтобы завершить процедуру и обновить таблицу разделов, введите
   partprobe /dev/sdb
   Новый раздел теперь готов к использованию.

   ![23](image/23.png)

   ![24](image/24.png)

8. Просмотрите информацию о добавленных разделах:
   cat /proc/partitions
   fdisk --list /dev/sdb

   ![25](image/25.png) Создание раздела подкачки

9. Получите полномочия администратора. Запустите fdisk:
   fdisk /dev/sdb

   ![26](image/26.png)

10. Нажмите n , чтобы добавить новый раздел. Утилита сообщит, что нет свободных первичных разделов и по умолчанию предложит добавить логический раздел с номером раздела 6.

    ![27](image/27.png)

11. Нажмите Enter, чтобы принять первый сектор по умолчанию. На вопрос о последнем секторе введите +100M (или любой другой размер, который вы хотите использовать).

    ![28](image/28.png)

12. Далее измените тип раздела. Для этого нажмите t , затем укажите номер партиции, для которой хотите изменить тип (в данном случае это номер 6). Затем введите код типа раздела (в данном случае 82 — раздел подкачки).

    ![29](image/29.png)

13. После создания логического раздела введите w , чтобы записать изменения на диск и выйти из fdisk. Чтобы завершить процедуру и обновить таблицу разделов ядра, введите
    partprobe /dev/sdb
    Новый раздел теперь готов к использованию.

    ![30](image/30.png)

14. Просмотрите информацию о добавленных разделах:
    cat /proc/partitions
    fdisk --list /dev/sdb

    ![31](image/31.png)

15. Отформатируйте раздел подкачки, используя команду
    mkswap /dev/sdb6

    ![32](image/32.png)

16. Для включения вновь выделенного пространства подкачки используйте
    swapon /dev/sdb6

    ![33](image/33.png)

17. Для просмотра размера пространства подкачки, которое в настоящее время выделено, введите
    free -m.

    ![34](image/34.png)

## Создание разделов GPT с помощью gdisk

1. В терминале с полномочиями администратора с помощью gdisk посмотрите таблицы
   разделов и разделы на втором добавленном вами ранее диске /dev/sdc:
   gdisk -l /dev/sdc

   ![35](image/35.png)

2. Создайте раздел с помощью gdisk:
   gdisk /dev/sdc

   Программа gdisk попытается определить текущее разбиение диска, и если ничего не
   обнаружено, то будет создана таблица разделов GPT и соответствующее разбиение
   диска.

   ![36](image/36.png)

3. Введите n , чтобы добавить новый раздел. Вы можете выбрать любой номер раздела между 1 и 128, но разумно принять номер раздела по умолчанию, который предлагается.

   ![37](image/37.png)

4. Теперь вас попросят задать первый сектор. По умолчанию будет использоваться первый сектор, доступный на диске, но также можно указать смещение. Нажмите Enter, чтобы принять предлагаемый по умолчанию первый сектор.

   ![38](image/38.png)

5. При запросе последнего сектора по умолчанию предлагается последний сектор, доступный на диске (создаётся раздел, который заполняет весь жёсткий диск). Можно указать другой последний сектор или указать размер диска, используя +, размер и размерность (KMGTP). Чтобы создать раздел диска размером 100 MiB, используйте +100M.

   ![39](image/39.png)

6. Теперь предлагается установить тип раздела. Если ничего не делать, то тип раздела
   устанавливается в 8300, что является типом раздела файловой системы Linux. Также
   доступны другие варианты. Можно нажать l , чтобы отобразить список доступных
   типов разделов. Вам интересны следующие типы разделов:
   – 8200: Linux swap;
   – 8300: Linux;
   – 8e00: Linux LVM.
   Обратите внимание, что это те же типы разделов, которые используются в MBR, с двумя нулями, добавленными к их именам. Можно просто нажать Enter , чтобы принять тип раздела 8300 по умолчанию.

   ![40](image/40.png)

7. Теперь раздел создан (но ещё не записан на диск). Нажмите p , чтобы отобразить разбиение диска.

   ![41](image/41.png)

8. Если текущее разбиение устраивает, нажмите w , чтобы записать изменения на диск.

   ![42](image/42.png)

9. Обновите таблицу разделов:
   partprobe /dev/sdc

   ![43](image/43.png)

10. Просмотрите информацию о добавленных разделах:
    cat /proc/partitions
    gdisk -l /dev/sdc

    ![44](image/44.png)

    ![45](image/45.png)

## Форматирование файловой системы XFS

1. В терминале с полномочиями администратора для диска dev/sdb1 создайте файловую систему XFS:
   mkfs.xfs /dev/sdb1

   ![46](image/46.png)

2. Для установки метки файловой системы в xfsdisk используйте команду
   xfs_admin -L xfsdisk /dev/sdb1

   ![47](image/47.png)

## Форматирование файловой системы EXT4

1. В терминале с полномочиями администратора для диска dev/sdb5 создайте файловую систему EXT4:
   mkfs.ext4 /dev/sdb5

   ![48](image/48.png)

2. Для установки метки файловой системы в ext4disk используйте команду
   tune2fs -L ext4disk /dev/sdb5
3. Для установки параметров монтирования по умолчанию для файловой системы используйте команду
   tune2fs -o acl,user_xattr /dev/sdb5
   В данном случае включены списки контроля доступа и расширенные атрибуты пользователя.

## Ручное монтирование файловых систем

Для ручной установки файловой системы используется команда mount. Чтобы отключить смонтированную файловую систему, используется команда umount.

1. Получите полномочия администратора. Для создания точки монтирования для раздела введите
   mkdir -p /mnt/tmp

   ![49](image/49.png)

2. Чтобы смонтировать файловую систему, используйте следующую команду
   mount /dev/sdb5 /mnt/tmp

   ![50](image/50.png)

3. Для проверки корректности монтирования раздела введите:
   mount

   ![51](image/51.png)

4. Чтобы отмонтировать раздел, можно использовать umount либо с именем устройства, либо с именем точки монтирования. Таким образом, обе следующие команды будут работать:
   umount /dev/sdb5
   или
   umount /mnt/tmp
5. Проверьте, что раздел отмонтирован:
   mount

   ![52](image/52.png)

## Монтирование разделов с помощью /etc/fstab

В этом упражнении требуется подмонтировать отформатированный раздел XFS
/dev/sdb1, который был создан в предыдущих упражнениях.

1. Получите полномочия администратора.
2. Создайте точку монтирования для раздела XFS /dev/sdb1:
   mkdir -p /mnt/data

   ![53](image/53.png)

3. Посмотрите информацию об идентификаторах блочных устройств (UUID):
   blkid
   Эта утилита позволяет определить тип файловой системы блочного устройства (TYPE), его идентификатор (UUID) и метку тома (LABEL). UUID представляет собой 16-байтный (128-битный) номер. В каноническом представлении UUID отображается в виде числа в шестнадцатеричной системе счисления, разделённого дефисами на пять групп в формате 8-4-4-4-12. Такое представление занимает 36 символов.

   ![54](image/54.png)

4. Введите blkid /dev/sdb1 и затем используйте мышь, чтобы скопировать значение идентификатора UUID для устройства /dev/sdb1.

   ![55](image/55.png)

5. Откройте файл /etc/fstab на редактирование и добавьте следующую строку:
   UUID=значение_идентификатора /mnt/data xfs defaults 1 2

   ![56](image/56.png)

6. Перед попыткой автоматического монтирования при перезагрузке рекомендуется проверить конфигурацию. Следующая команда монтирует всё, что указано в /etc/fstab:
   mount -a

   ![57](image/57.png)

7. Проверьте, что раздел примонтирован правильно:
   df -h

   ![58](image/58.png)

# Самостоятельная работа

1. Добавьте две партиции на диск с разбиением GPT. Создайте оба раздела размером 100 MiB. Один из этих разделов должен быть настроен как пространство подкачки, другой раздел должен быть отформатирован файловой системой ext4.

   ![59](image/59.png)

   ![60](image/60.png)

2. Настройте сервер для автоматического монтирования этих разделов. Установите раздел ext4 на /mnt/data-ext и установите пространство подкачки в качестве области подкачки.

   ![61](image/61.png)

3. Перезагрузите вашу систему и убедитесь, что всё установлено правильно.

   ![62](image/62.png)

# Контрольные вопросы

1. Какой инструмент используется для создания разделов GUID?
   gdisk (утилита GPT fdisk).

2. Какой инструмент применяется для создания разделов MBR?
   fdisk.

3. Какой файл используется для автоматического монтирования разделов во время загрузки?
   /etc/fstab.

4. Какой вариант монтирования выбрать, чтобы файловая система не монтировалась автоматически?
   Опция noauto в fstab.

5. Какая команда позволяет форматировать раздел с типом 82 (swap)?
   mkswap /dev/… (тип 82 — Linux swap).

6. Как безопасно проверить автоматическое монтирование без перезагрузки?
   Выполнить команду mount -a.

7. Какая файловая система создаётся, если использовать mkfs без указания типа?
   По умолчанию создаётся EXT2.

8. Как форматировать раздел EXT4?
   mkfs.ext4 /dev/…

9. Как найти UUID для всех устройств на компьютере?
   Командой blkid

# Выводы

Я получил навыки создания разделов на диске и файловых систем. Я получил навыки монтирования файловых систем.

# Список литературы{.unnumbered}

::: {#refs}
:::

---
# Preamble

## Author
author:
  name: Гелдиев Ыхлас
  degrees: DSc
  orcid: 0000-0002-0877-7063
  email: 1032249184@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: "Лабораторная работа № 9"
subtitle: "Управление SELinux"
license: CC BY
date: 2025-10-31
## Generic options
lang: ru-RU
crossref:
  lof-title: Список иллюстраций
  lot-title: Список таблиц
  lol-title: Листинги
## Formats
format:
  ### Pdf output format
  beamer:
    include-in-header:
      text: |
        \usepackage{fontspec}
        \setmainfont{Noto Serif}
        \setsansfont{Noto Sans}
    toc: true
    toc-title: Содержание
    number-sections: true
    colorlinks: false
    toc-depth: 2
    slide_level: 2
    aspectratio: 169
    section-titles: true
    theme: metropolis
    themeoptions: progressbar=frametitle,sectionpage=progressbar,numbering=fraction
    #### Language
    babel-lang: russian
    babel-otherlangs: english
  ### Html output
  revealjs:
    transition: slide
    margin: 0.2
    smaller: false
    output-ext: html
    theme: beige
    logo: _resources/image/logo_rudn.png
---

# Информация

## Докладчик

- Гелдиев Ыхлас
- студент
- Российский университет дружбы народов им. П. Лумумбы
- [1032249184@pfur.ru](mailto:1032249184@pfur.ru)
- <https://geldiyevy.github.io/ru/>

# Вводная часть

## Цель работы

Получить навыки работы с контекстом безопасности и политиками SELinux.

## Задание

1. Продемонстрируйте навыки по управлению режимами SELinux (см. раздел 9.4.1).
2. Продемонстрируйте навыки по восстановлению контекста безопасности SELinux (см. раздел 9.4.2).
3. Настройте контекст безопасности для нестандартного расположения файлов вебслужбы (см. раздел 9.4.3).
4. Продемонстрируйте навыки работы с переключателями SELinux (см. раздел 9.4.4)

# Выполнение лабораторной работы

# Управление режимами SELinux

## Запустите терминал и получите полномочия администратора: ([рис. @fig-001])

su -

## Просмотрите текущую информацию о состоянии SELinux: ([рис. @fig-001])

sestatus -v

![1](image/1.png){#fig-001}

## В отчёте построчно поясните выведенную на экран информацию:

**sestatus -v** – выводит статус SELinux с подробными деталями.

- **SELinux status:** `enabled` — SELinux активен.
- **SELinuxfs mount:** `/sys/fs/selinux` — точка монтирования файловой системы SELinux.
- **Current mode:** `enforcing` — текущий режим (применяется политика).
- **Mode from config file:** `enforcing` — режим, указанный в `/etc/selinux/config`.
- **Policy version:** `31` — номер версии загруженной политики.
- **Policy from config file:** `targeted` — тип политики, указанной в конфиге.
- **Policy MLS status:** `disabled` — поддержка MLS/MCS отключена.
- **Policy deny_unknown:** `allowed` — неизвестные типы объектов допускаются.
- **Max kernel policy bytes:** `524288` — максимальный размер политики, который ядро может загрузить.
- **Policy loaded:** `yes` — политика успешно загружена.
- **Policy caps:** `0` — количество ограничений (caps) в текущей политике.
- **Policy booleans:** `<число>` — количество определённых булевых переменных.
- **Policy modules:** `<число>` — количество загруженных модулей политики.
- **Policy file context:** `/etc/selinux/targeted/contexts/files` — путь к файлам контекстов.
- **Policy users:** `<число>` — количество определённых SELinux‑пользователей.
- **Policy roles:** `<число>` — количество ролей.
- **Policy types:** `<число>` — количество типов объектов.
- **Policy levels:** `0` — уровни MLS/MCS (отключены).
- **Policy categories:** `0` — категории MLS/MCS (отключены).

## Посмотрите, в каком режиме работает SELinux:

getenforce
По умолчанию SELinux находится в режиме принудительного исполнения (Enforcing).

![2](image/2.png)

## Измените режим работы SELinux на разрешающий (Permissive):

setenforce 0

и снова введите
getenforce

![3](image/3.png)

## В файле /etc/sysconfig/selinux с помощью редактора установите

SELINUX=disabled
Перезагрузите систему.

![4](image/4.png)

## После перезагрузки запустите терминал и получите полномочия администратора. ([рис. @fig-002])

## Посмотрите статус SELinux: ([рис. @fig-002])

getenforce
Вы увидите, что SELinux теперь отключён.

## Попробуйте переключить режим работы SELinux: ([рис. @fig-002])

setenforce 1

![5](image/5.png){#fig-002}

## Какая реакция системы?

Вы не можете переключаться между отключённым и принудительным режимом без перезагрузки системы.

## Откройте файл /etc/sysconfig/selinux с помощью редактора и установите:

SELINUX=enforcing
Перезагрузите систему.

![6](image/6.png)

## Во время загрузки системы вы, скорее, всего получите предупреждающее сообщение о необходимости восстановления меток SELinux, что может занять некоторое время, а также потребует дополнительной перезагрузки системы.

![7](image/7.png)

## После перезагрузки в терминале с полномочиями администратора просмотрите текущую информацию о состоянии SELinux:

sestatus -v
Убедитесь, что система работает в принудительном режиме (enforcing) использования SELinux

![8](image/8.png)

# Использование restorecon для восстановления контекста безопасности

## Запустите терминал и получите полномочия администратора

![9](image/9.png)

## Посмотрите контекст безопасности файла /etc/hosts: ([рим. @fig-004])

ls -Z /etc/hosts
Вы увидите, что у файла есть метка контекста net_conf_t.

## Скопируйте файл /etc/hosts в домашний каталог: ([рим. @fig-004])

cp /etc/hosts ~/
Проверьте контекст файла ~/hosts: ([рим. @fig-004])
ls -Z ~/hosts
Поскольку копирование считается созданием нового файла, то параметр контекста в файле ~/hosts, расположенном в домашнем каталоге, станет admin_home_t.

##

![10](image/10.png){#fig-004}

## Попытайтесь перезаписать существующий файл hosts из домашнего каталога в каталог /etc:

mv ~/hosts /etc
и подтвердите, что вы хотите сделать это.

![11](image/11.png)

## Убедитесь, что тип контекста по-прежнему установлен на admin_home_t:

ls -Z /etc/hosts

![12](image/12.png)

## Исправьте контекст безопасности:

restorecon -v /etc/hosts
Опция -v покажет процесс изменения.

![13](image/13.png)

## Убедитесь, что тип контекста изменился:

ls -Z /etc/hosts

![14](image/14.png)

## Для массового исправления контекста безопасности на файловой системе введите

touch /.autorelabel
И перезагрузите систему. Во время перезапуска не забудьте нажать клавишу Esc на клавиатуре, чтобы вы видели загрузочные сообщения. Вы увидите, что файловая система автоматически перемаркирована.

![15](image/15.png)

##

![16](image/16.png)

# Настройка контекста безопасности для нестандартного расположения файлов веб-сервера

## Запустите терминал и получите полномочия администратора.

![17](image/17.png)

## Установите необходимое программное обеспечение:

dnf -y install httpd
dnf -y install lynx

![18](image/18.png)

## Создайте новое хранилище для файлов web-сервера:

mkdir /web

![19](image/19.png)

## Создайте файл index.html в каталоге с контентом веб-сервера:

cd /web
touch index.html

![20](image/20.png)

## и поместите в файл следующий текст:

Welcome to my web-server

![21](image/21.png)

## В файле /etc/httpd/conf/httpd.conf закомментируйте строку

DocumentRoot "/var/www/html"
и ниже добавьте строку
DocumentRoot "/web"
Затем в этом же файле ниже закомментируйте раздел
<Directory "/var/www">
AllowOverride None
Require all granted
</Directory>
и добавьте следующий раздел, определяющий правила доступа:
<Directory "/web">
AllowOverride None
Require all granted
</Directory>

##

![22](image/22.png)

## Запустите веб-сервер и службу httpd:

systemctl start httpd
systemctl enable httpd

![23](image/23.png)

## В терминале под учётной записью своего пользователя при обращении к веб-серверу в текстовом браузере lynx:

lynx http://localhost
вы увидите веб-страницу Red Hat по умолчанию, а не содержимое только что созданного файла index.html.

В нижней части терминала с lynx указаны подсказки по навигации. Для выхода из
lynx нажмите q .

![24](image/24.png)

## В терминале с полномочиями администратора примените новую метку контекста

к /web:
semanage fcontext -a -t httpd_sys_content_t "/web(/.\*)?"

![25](image/25.png)

## Восстановите контекст безопасности:

restorecon -R -v /web

![26](image/26.png)

## В терминале под учётной записью своего пользователя снова обратитесь к веб-серверу:

lynx http://localhost
Теперь вы получите доступ к своей пользовательской веб-странице. Если этого не произошло, то перегрузите систему и снова попытайтесь получить доступ к своей пользовательской веб-странице. В случае успеха на экране должна быть отображена запись «Welcome to my web-server».

![26](image/27.png)

# Работа с переключателями SELinux

## Запустите терминал и получите полномочия администратора.

![28](image/28.png)

## Посмотрите список переключателей SELinux для службы ftp:

getsebool -a | grep ftp
Вы увидите переключатель ftpd_anon_write с текущим значением off.

![29](image/29.png)

## Для службы ftpd_anon посмотрите список переключателей с пояснением, за что отвечает каждый переключатель, включён он или выключен:

- ftpd_anon – разрешает анонимный FTP‑доступ (FTP‑демон может обслуживать анонимных пользователей). Он выключен.

semanage boolean -l | grep ftpd_anon

![30](image/30.png)

## Измените текущее значение переключателя для службы ftpd_anon_write с off на on:

setsebool ftpd_anon_write on

![31](image/31.png)

## Повторно посмотрите список переключателей SELinux для службы ftpd_anon_write:

getsebool ftpd_anon_write

![32](image/32.png)

## Посмотрите список переключателей с пояснением:

semanage boolean -l | grep ftpd_anon
Обратите внимание, что настройка времени выполнения включена, но постоянная настройка по-прежнему отключена.

![33](image/33.png)

## Измените постоянное значение переключателя для службы ftpd_anon_write с off на on:

setsebool -P ftpd_anon_write on

![34](image/34.png)

## Посмотрите список переключателей:

semanage boolean -l | grep ftpd_anon
В отчёте отразите, какое состояние имеет переключатель?

![35](image/35.png)

Переключатель имеет состояние (on, on), что означает что оно сейчас и при перезапуске будет включено

## Выводы

Я получил навыки работы с контекстом безопасности и политиками SELinux.
